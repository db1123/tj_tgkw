<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <!--_global å…¬å…±é…ç½®æ–‡ä»¶ -->
    <script language="javascript">var golbal_type = "admin";</script>
    <script type="text/javascript" src="/javascript/global.js"></script><!--/_global å…¬å…±é…ç½®æ–‡ä»¶-->
    <!--_only ç‹¬ç«‹æ ·å¼ -->
    <link rel="stylesheet" href="/plugins/select2/css/select2.min.css">
    <link rel="stylesheet" href="/plugins/select2-ztree/bootstrapStyle.css"/>
    <link rel="stylesheet" href="/plugins/jquery-jsonview/jquery.jsonview.css"/>
    <link rel="stylesheet" href="/nui-ad/lib/zTree/v3/css/zTreeStyle/zTreeStyle.css"/>
    <link rel="stylesheet" href="/nui-ad/lib/datatables/1.10.15/styling/base_style/jquery.dataTables.min.css">
    <!--/_only ç‹¬ç«‹æ ·å¼ -->
</head>

<style>
    /* ç”»å»Šå®¹å™¨ */
    .gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        gap: 30px;
        padding: 30px;
        max-width: 1200px;
        margin: 0 auto;

    }



    /* å›¾ç‰‡é¡¹æ ·å¼ */
    .img-item {
        position: relative;
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        overflow: hidden;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        cursor: pointer;
        margin: 8px;
    }

    .img-item:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 20px rgba(0,0,0,0.15);
    }

    .thumbnail {
        width: 100%;
        height: 180px;
        object-fit: cover;
        border-bottom: 1px solid #eee;
    }

    .img-name {
        padding: 15px;
        text-align: center;
        font-size: 16px;
        color: #333;
        font-family: Arial, sans-serif;
    }

    /* åˆ é™¤æŒ‰é’® */
    .delete-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 28px;
        height: 28px;
        background: #ff4757;
        color: white;
        border: none;
        border-radius: 50%;
        font-size: 18px;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    /* æ–°å¢ç¼–è¾‘æŒ‰é’®æ ·å¼ */
    .edit-btn {
        position: absolute;
        top: 10px;
        right: 45px; /* ä¸åˆ é™¤æŒ‰é’®ä¿æŒé—´è· */
        width: 28px;
        height: 28px;
        background: #2d98da;
        color: white;
        border: none;
        border-radius: 50%;
        font-size: 18px;
        cursor: pointer;
        opacity: 0;
        transition: opacity 0.3s ease;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .img-item:hover .edit-btn {
        opacity: 1;
    }

    .img-item:hover .delete-btn {
        opacity: 1;
    }

    /* é®ç½©å±‚æ ·å¼ */
    .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0,0,0,0.9);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 1000;
    }

    .img-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 20px;
        max-width: 90vw;
        max-height: 90vh;
    }

    /* æ§åˆ¶å·¥å…·æ  */
    .controls-container {
        display: flex;
        gap: 15px;
        padding: 12px 20px;
        background: rgba(255,255,255,0.9);
        border-radius: 30px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.2);
    }

    /* æ§åˆ¶æŒ‰é’® */
    .rotate-btn {
        width: 40px;
        height: 40px;
        background: #fff;
        border: none;
        border-radius: 50%;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }

    .reset-btn {
        width: 40px;
        height: 40px;
        background: #4CAF50;
        color: white;
        border: none;
        border-radius: 50%;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .rotate-btn:hover {
        background: #f1f1f1;
        transform: scale(1.1);
    }

    .reset-btn:hover {
        background: #45a049;
        transform: scale(1.1);
    }

    /* ç¼©æ”¾å›¾ç‰‡ */
    #zoomedImg {
        max-width: 100%;
        max-height: 70vh;
        transition: transform 0.3s ease;
        cursor: grab;
        display: block;
        margin: 0 auto;
        border-radius: 8px;
    }

    /* å…³é—­æŒ‰é’® */
    .close-btn {
        position: absolute;
        top: 20px;
        right: 20px;
        width: 40px;
        height: 40px;
        background: #ff4757;
        color: white;
        border: none;
        border-radius: 50%;
        font-size: 24px;
        cursor: pointer;
    }



    /* ç©ºçŠ¶æ€æç¤º */
    .empty-state {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
        padding: 2rem 3rem;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(8px);
        animation: fadeIn 0.6s ease;
        border: 1px solid rgba(0, 0, 0, 0.05);
    }

    .empty-state::before {
        content: "ğŸ–¼ï¸";
        font-size: 3.5rem;
        display: block;
        margin-bottom: 1rem;
        opacity: 0.8;
    }

    .empty-state p {
        margin: 0;
        font-size: 1.2rem;
        color: #666;
        letter-spacing: 0.5px;
        font-weight: 500;
    }

    /*************************å…¨å±************************************/
    /* åœ¨æ§åˆ¶å®¹å™¨æ·»åŠ å…¨å±æŒ‰é’® */
    .controls-container {
        position: relative; /* ä¸ºå…¨å±æç¤ºå®šä½ */
    }

    .fullscreen-btn {
        width: 40px;
        height: 40px;
        background: #ff9f43;
        color: white;
        border: none;
        border-radius: 50%;
        font-size: 18px;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .fullscreen-btn:hover {
        background: #ff7d33;
        transform: scale(1.1);
    }

    /* å…¨å±æ ·å¼è°ƒæ•´ */
    :fullscreen .img-container {
        max-width: 95vw;
        max-height: 95vh;
    }

    :fullscreen #zoomedImg {
        max-height: 85vh;
    }

    :-webkit-full-screen .controls-container {
        padding: 20px 30px;
    }

    /* å…¨å±ä¸“å±æ ·å¼ */
    .fullscreen-active .close-btn {
        display: none; /* å…¨å±æ—¶éšè—å…³é—­æŒ‰é’® */
    }

    .fullscreen-active .img-container {
        padding: 2vh 2vw;
    }

    :fullscreen .controls-container {
        background: rgba(255, 255, 255, 0.95);
    }

    /* æ·»åŠ å…¨å±çŠ¶æ€æŒ‡ç¤º */
    .overlay:fullscreen {
        background: rgba(0,0,0,0.95);
    }

    .overlay:fullscreen .img-container {
        border: 2px solid rgba(255,255,255,0.1);
        border-radius: 12px;
    }
    /**************************endå…¨å±************************************/
</style>
<body>
<div class="page-container" style="padding: 2px;">
    <div class="f-l text-l" id="adddiv" style="display: none;">
        <button type="button" class="btn btn-default size-S my-btn" onclick="Values(1)"><i
                class=" fa fa-plus"></i>
            æ‰¹é‡ä¸Šä¼ å›¾ç‰‡
        </button>
    </div>
    <div class="f-r text-r">
        <input type="text" class="input-text size-S form-text-FName" style="width:200px" placeholder="å›¾ç‰‡åç§°">
        <button type="button" class="btn btn-default size-S my-btn btn-search-fun"><i class="Hui-iconfont">&#xe665;</i>
            æœç´¢
        </button>
    </div>
    <div class="f-l" style="width: 100%; margin-top: 3px;">
        <div class="empty-state" id="emptyState">
            <p><span id="emptyStateName"></span></p>
        </div>
        <div class="gallery" id="gallery">
<!--            &lt;!&ndash; å›¾ç‰‡é¡¹ &ndash;&gt;-->
<!--            <div class="img-item">-->
<!--                <img src="D:\tupian.png" class="thumbnail" alt="å›¾ç‰‡1">-->
<!--                <button class="delete-btn">Ã—</button>-->
<!--                <div class="img-name">å›¾ç‰‡1</div>-->
<!--            </div>-->
<!--            <div class="img-item">-->
<!--                <img src="image2.jpg" class="thumbnail" alt="å›¾ç‰‡2">-->
<!--                <button class="delete-btn">Ã—</button>-->
<!--                <div class="img-name">å›¾ç‰‡2</div>-->
<!--            </div>-->
<!--            &lt;!&ndash; æ›´å¤šå›¾ç‰‡... &ndash;&gt;-->
        </div>

        <!-- é®ç½©å±‚ -->
        <div class="overlay">
            <div class="img-container">
                <button class="close-btn" onclick="closeOverlay()">Ã—</button>
                <img id="zoomedImg" src="" draggable="false">
                <div class="controls-container">
                    <button class="rotate-btn" title="æ—‹è½¬-90Â°" onclick="rotate(-90)">â†º</button>
                    <button class="rotate-btn" title="æ—‹è½¬90Â°" onclick="rotate(90)">â†»</button>
                    <button class="reset-btn" title="å¤ä½" onclick="resetTransform()">âŸ²</button>
                    <button class="fullscreen-btn" title="å…¨å±æ˜¾ç¤º" onclick="toggleFullscreen()">â¤¡</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript" src="/nui-ad/lib/zTree/v3/js/jquery.ztree.all-3.5.min.js"></script>
<script type="text/javascript" src="/nui-ad/lib/zTree/v3/js/jquery.ztree.exhide-3.5.min.js"></script>
<script type="text/javascript" src="/plugins/select2/js/select2.full.min.js"></script>
<script type="text/javascript" src="/plugins/select2-ztree/select2-ztree.js"></script>
<script type="text/javascript" src="/plugins/select2-ztree/select2-ztree-search.js"></script>
<script type="text/javascript" src="/plugins/jquery-jsonview/jquery.jsonview.js"></script>
<script src="/plugins/select2/js/select2.full.min.js"></script>
<script type="text/javascript" src="/nui-ad/lib/datatables/1.10.15/jquery.dataTables.min.js"></script>

<script type="text/javascript">

    var id = getQueryStringByName('tpid');//åŸ¹å…»ID
    var fmajorid = getQueryStringByName('fmajorid');//ä¸“ä¸šID
    var showtype = getQueryStringByName('showtype'); //æ˜¾ç¤ºç±»å‹

    // é®ç½©å±‚äº¤äº’
    let scale = 1;
    let rotation = 0;
    let isDragging = false;
    let startX, startY, translateX = 0, translateY = 0;

    var chaxun=1;
    // ä¸šåŠ¡ä»£ç 
    $(function () {

        if (showtype == 1) {
            $("#adddiv").show();
        } else {
            $("#adddiv").hide();
        }
        chaxun = 1;
        // è‡ªåŠ¨æ£€æµ‹å†…å®¹
        function checkContent() {
            const gallery = document.getElementById('gallery');
            const emptyState = document.getElementById('emptyState');

            if (gallery && gallery.children.length > 0) {
                gallery.style.display = 'grid';
                emptyState.style.display = 'none';
            } else {
                gallery.style.display = 'none';
                emptyState.style.display = 'block';
                if(chaxun == 2){
                    $("#emptyStateName").text("æœªæŸ¥è¯¢åˆ°å›¾ç‰‡");
                }else{
                    $("#emptyStateName").text("æœªä¸Šä¼ å›¾ç‰‡");
                }
            }
        }

        // åˆå§‹åŒ–æ£€æµ‹
        checkContent();
        // ç›‘å¬DOMå˜åŒ–ï¼ˆé€‚ç”¨äºåŠ¨æ€åŠ è½½å†…å®¹ï¼‰
        const observer = new MutationObserver(checkContent);
        observer.observe(gallery, { childList: true });

        loadImages();



        // æŸ¥è¯¢æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        $('.btn-search-fun').on('click', function () {
            chaxun = 2;
            if($(".form-text-FName").val() == null || $(".form-text-FName").val() == ""){
                chaxun = 1;
            }
            loadImages();

            console.log(chaxun);
        });

    });

    // æ¨¡æ‹Ÿå¼‚æ­¥åŠ è½½æ•°æ®
    function loadImages() {
        // const gallery = document.querySelector('.gallery');
        var  gallery = $("#gallery");
        gallery.empty();
        //è·å–å½“å‰æ–¹æ¡ˆä¸­çš„å›¾ç‰‡ä¿¡æ¯
        $.ajax({
            type: 'POST',
            contentType: 'application/json;charset=UTF-8',
            url: '/s/trainingprogramimage/querytrainingprogrammb',
            data: JSON.stringify({
                FTPID: id,
                name:$(".form-text-FName").val()
            }),
            success: function (data) {
                if (data.result == 'success') {
                    // console.log("data.list:" + data.list);
                    if(data.list != null && data.list != "" && data.list != 'undefined'){
                        const jsonObj = JSON.parse(data.list);

                        // ç”Ÿæˆå›¾ç‰‡é¡¹
                        jsonObj.forEach(item => {
                            var fileUrl = YULANIP + '' + item.FRelativePath1;
                            // console.log(fileUrl);
                            const imgItem = document.createElement('div');
                            imgItem.className = 'img-item';
                            imgItem.innerHTML = `
                            <img src="${fileUrl}" class="thumbnail" alt="${item.FName}">
                            <div class="imageeditdiv" style="display: none;">
                                <button class="delete-btn" onclick="delimage('${item.key}','${item.FName}')">Ã—</button>
                                <button class="action-btn edit-btn" onclick="updata('${item.key}')">âœ</button>
                            </div>
                            <div class="img-name">${item.FName}</div>
                        `;
                            // gallery.appendChild(imgItem);
                            gallery.append(imgItem);
                            if(showtype ==1){
                                $(".imageeditdiv").show();
                            }else{
                                $(".imageeditdiv").hide();
                            }
                        });
                    }

                    // å›¾ç‰‡ç‚¹å‡»äº‹ä»¶
                    document.querySelectorAll('.img-item').forEach(item => {
                        item.addEventListener('click', function(e) {
                            if(e.target.classList.contains('delete-btn') || e.target.classList.contains('edit-btn') ) return;
                            const imgSrc = this.querySelector('img').src;
                            document.querySelector('#zoomedImg').src = imgSrc;
                            document.querySelector('.overlay').style.display = 'flex';
                            resetTransform();
                        });
                    });



                    // æ‹–æ‹½åŠŸèƒ½
                    document.querySelector('#zoomedImg').addEventListener('mousedown', (e) => {
                        isDragging = true;
                        startX = e.clientX - translateX;
                        startY = e.clientY - translateY;
                        e.target.style.cursor = 'grabbing';
                    });

                    document.addEventListener('mousemove', (e) => {
                        if (!isDragging) return;
                        translateX = e.clientX - startX;
                        translateY = e.clientY - startY;
                        updateTransform();
                    });

                    document.addEventListener('mouseup', () => {
                        isDragging = false;
                        document.querySelector('#zoomedImg').style.cursor = 'grab';
                    });

                    // ç¼©æ”¾åŠŸèƒ½
                    document.querySelector('#zoomedImg').addEventListener('wheel', (e) => {
                        e.preventDefault();
                        scale *= e.deltaY > 0 ? 0.9 : 1.1;
                        updateTransform();
                    });

                    // ç‚¹å‡»é®ç½©å±‚èƒŒæ™¯å…³é—­
                    document.querySelector('.overlay').addEventListener('click', (e) => {
                        if (e.target === document.querySelector('.overlay')) {
                            closeOverlay();
                        }
                    });


                    // å¢å¼ºå…¨å±çŠ¶æ€ç›‘å¬
                    document.addEventListener('fullscreenchange', () => {
                        const overlay = document.querySelector('.overlay');
                        if (!document.fullscreenElement && overlay.style.display === 'flex') {
                            // å¦‚æœç”¨æˆ·é€šè¿‡ESCé€€å‡ºå…¨å±ä½†ä»åœ¨æŸ¥çœ‹å›¾ç‰‡
                            updateFullscreenButton();
                        } else if (!document.fullscreenElement) {
                            // å¦‚æœå…¨å±å…³é—­ä¸”é®ç½©å±‚å·²éšè—
                            resetTransform();
                        }
                    });
                    document.addEventListener('webkitfullscreenchange', updateFullscreenButton);
                    // æ·»åŠ é”®ç›˜å¿«æ·é”®æ”¯æŒ
                    document.addEventListener('keydown', (e) => {
                        if (e.key === 'f' && document.querySelector('.overlay').style.display === 'flex') {
                            toggleFullscreen();
                        }
                    });

                    // å…¨å±çŠ¶æ€ä¸‹çš„æ ·å¼ä¼˜åŒ–
                    document.addEventListener('fullscreenchange', () => {
                        document.querySelector('.overlay').classList.toggle('fullscreen-active');
                    });



                }
                if (data.result == 'error') {
                    toastr.error(data.error);
                }
            },
            error: function (e) {
                toastr.error(e.status);
                toastr.error(e.responseText);
            }
        });
    }


    function resetTransform() {
        scale = 1;
        rotation = 0;
        translateX = translateY = 0;
        updateTransform();
    }

    function updateTransform() {
        const img = document.querySelector('#zoomedImg');
        img.style.transform = `
                translate(${translateX}px, ${translateY}px)
                scale(${scale})
                rotate(${rotation}deg)
            `;
    }

    // æ—‹è½¬åŠŸèƒ½
    function rotate(degrees) {
        rotation += degrees;
        updateTransform();
    }

    // å…³é—­é®ç½©å±‚
    function closeOverlay() {
        document.querySelector('.overlay').style.display = 'none';
        // å¼ºåˆ¶é€€å‡ºå…¨å±
        if (document.fullscreenElement) {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) { /* Safari */
                document.webkitExitFullscreen();
            }
        }

        // é‡ç½®å˜æ¢å‚æ•°
        resetTransform();
    }


    // ä¿®æ”¹å…¨å±åˆ‡æ¢å‡½æ•°
    function toggleFullscreen() {
        const container = document.querySelector('.img-container');

        if (!document.fullscreenElement) {
            // è¿›å…¥å…¨å±å‰ç¡®ä¿é®ç½©å±‚å¯è§
            document.querySelector('.overlay').style.display = 'flex';
            if (container.requestFullscreen) {
                container.requestFullscreen();
            } else if (container.webkitRequestFullscreen) {
                container.webkitRequestFullscreen();
            }
        } else {
            // é€€å‡ºå…¨å±æ—¶ä¿æŒé®ç½©å±‚å¯è§
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            }
        }
    }
    function updateFullscreenButton() {
        const btn = document.querySelector('.fullscreen-btn');
        btn.innerHTML = document.fullscreenElement ? 'â¤¢' : 'â¤¡';
    }


    // æ–°å¢æˆ–è€…ä¿®æ”¹ç‚¹å‡»äº‹ä»¶
    function Values(op, fKey) {
        if (op == 1) { // æ–°å¢
            // layer_show('ä¸Šä¼ å›¾ç‰‡', '/module/capability/trainingprogram/image/trainingprogramimage_up.html?op=1&FTPID=' + id + '&fmajorid=' + fmajorid, '1000', '400');
            // console.log("ftpid:" + id +" fmajorid:" + fmajorid)
            layer_show('æ‰¹é‡ä¸Šä¼ ','/module/capability/trainingprogram/image/trainingprogramimagemultiple.html?FTPID=' + id + '&fmajorid=' + fmajorid,'900','500');
        }
    }

    function delimage(fkeyid,name){
        // console.log("delimage:" +fkeyid + "," + name);
        layer.confirm('<b>' + name + '</b><br />ç¡®å®šè¦åˆ é™¤å—?', function (index) {
            $.ajax({
                type: 'POST',
                contentType: 'application/json;charset=UTF-8',
                url: '/s/trainingprogramimage/deltrainingprogramimage',
                data: JSON.stringify({
                    id: fkeyid
                }),
                success: function (data) {
                    if (data.result == 'success') {
                        loadImages();
                        toastr.success('åˆ é™¤æˆåŠŸï¼');
                        layer.close(layer.index);
                    }
                    if (data.result == 'error') {
                        toastr.error(data.error);
                    }
                },
                error: function (e) {
                    toastr.error(e.status);
                    toastr.error(e.responseText);
                }
            });
        });

    }

    function updata(fkeyid){
        layer_show('ä¿®æ”¹å›¾ç‰‡åç§°','/module/capability/trainingprogram/image/trainingprogramimagenameedit.html?op=2&id=' + fkeyid,'600','200');
    }
</script>
</body>
</html>