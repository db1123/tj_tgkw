<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>基于语义嵌入网络的跨领域复杂设计知识关联挖掘与分析</title>
  <!-- Tailwind CSS v3 -->
 <!--  <script src="https://cdn.tailwindcss.com"></script> -->
  <!-- Font Awesome -->
 <!--  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet"> -->
  <script src="js/3.4.16"></script>
  <link href="fonts/font-awesome.min.css" rel="stylesheet">
  <!-- ECharts -->
 <!--  <script src="https://cdnjs.cloudflare.com/ajax/libs/echarts/5.3.0/echarts.min.js"></script> -->
  <script src="js/echarts.min.js"></script>
  <!-- 统一的 Tailwind 配置 -->
   <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#0052D9',
            secondary: '#00A870',
            accent: '#FF6B00',
            dark: '#1C2B36',
            light: '#F0F5FF',
            'primary-light': '#E6F7FF',
            'secondary-light': '#E6FFED',
            'accent-light': '#FFF2E6'
          },
          fontFamily: {
            sans: ['Inter', 'system-ui', 'sans-serif'],
          },
          boxShadow: {
            'card': '0 4px 12px rgba(0, 0, 0, 0.05)',
            'card-hover': '0 8px 16px rgba(0, 0, 0, 0.1)',
          }
        }
      },
      darkMode: 'class'
    }
  </script>
  <style type="text/tailwindcss">
    @layer utilities {
      .content-auto {
        content-visibility: auto;
      }
      .bg-gradient-blue {
        background: linear-gradient(135deg, #0052D9 0%, #0078D7 100%);
      }
      .text-shadow {
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      .transition-all-300 {
        transition: all 300ms ease-in-out;
      }
      .scrollbar-thin {
        scrollbar-width: thin;
      }
      .scrollbar-thin::-webkit-scrollbar {
        width: 6px;
      }
      .scrollbar-thin::-webkit-scrollbar-track {
        background: #f1f1f1;
      }
      .scrollbar-thin::-webkit-scrollbar-thumb {
        background: #888;
        border-radius: 3px;
      }
      .scrollbar-thin::-webkit-scrollbar-thumb:hover {
        background: #555;
      }
    }
  </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-900 dark:text-gray-100 min-h-screen flex flex-col">
  <!-- 顶部导航栏 -->
  <header class="bg-white dark:bg-gray-800 shadow-md z-10">
    <div class="container mx-auto px-4 py-3 flex items-center justify-between">
      <div class="flex items-center space-x-2">
        <i class="fa fa-sitemap text-primary text-2xl"></i>
        <h1 class="text-xl font-bold text-primary">知识关联挖掘与分析系统</h1>
      </div>
      <div class="flex items-center space-x-4">
        <button id="themeToggle" class="p-2 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 transition-all-300">
          <i class="fa fa-moon-o dark:hidden"></i>
          <i class="fa fa-sun-o hidden dark:block"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- 主要内容区域 -->
  <main class="flex-grow container mx-auto px-4 py-6 flex flex-col lg:flex-row gap-6">
    <!-- 左侧面板 -->
    <div class="lg:w-1/4 space-y-6">
      <!-- 文件上传区域 -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-card p-6 transition-all-300 hover:shadow-card-hover">
        <h2 class="text-lg font-semibold mb-4 flex items-center">
          <i class="fa fa-upload mr-2 text-primary"></i>文件上传
        </h2>
        <div id="dropArea" class="border-2 border-dashed border-gray-300 dark:border-gray-600 rounded-lg p-6 text-center cursor-pointer-pointer hover:border-primary dark:hover:border-primary transition-all-300">
          <i class="fa fa-cloud-upload text-4xl text-gray-400 dark:text-gray-500 mb-3"></i>
          <p class="mb-2">拖放文件到此处或点击上传</p>
          <p class="text-sm text-gray-500 dark:text-gray-400">支持 .txt, .csv, .json 格式</p>
          <input type="file" id="fileInput" class="hidden" accept=".txt,.csv,.json">
        </div>
        <div class="mt-4 flex flex-wrap gap-2">
          <button id="loadExampleBtn" class="px-4 py-2 bg-primary text-white rounded-lg hover:bg-blue-700 transition-all-300 flex items-center">
            <i class="fa fa-magic mr-2"></i>加载示例数据
          </button>
          <button id="clearDataBtn" class="px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-200 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-all-300 flex items-center">
            <i class="fa fa-trash mr-2"></i>清空数据
          </button>
        </div>
      </div>

      <!-- 生成图表按钮 -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-card p-6 transition-all-300 hover:shadow-card-hover">
        <button id="generateChartBtn" class="w-full px-4 py-3 bg-primary text-white rounded-lg hover:bg-blue-700 transition-all-300 flex items-center justify-center disabled:opacity-50 disabled:cursor-not-allowed" disabled>
          <i class="fa fa-bar-chart mr-2"></i>生成知识关联图表
        </button>
        <p class="text-sm text-gray-500 dark:text-gray-400 mt-3 text-center">点击生成按钮后将在右侧显示知识关联网络图表</p>
      </div>

      <!-- 数据结构树 -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-card p-6 transition-all-300 hover:shadow-card-hover">
        <h2 class="text-lg font-semibold mb-4 flex items-center">
          <i class="fa fa-tree mr-2 text-primary"></i>数据结构树
        </h2>
        <div id="dataTree" class="max-h-60 overflow-y-auto scrollbar-thin border border-gray-200 dark:border-gray-700 rounded-lg p-3">
          <p class="text-gray-500 dark:text-gray-400 text-center italic">暂无数据</p>
        </div>
      </div>

      <!-- 大文本框 -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-card p-6 transition-all-300 hover:shadow-card-hover">
        <div class="flex justify-between items-center mb-4">
          <h2 class="text-lg font-semibold flex items-center">
            <i class="fa fa-file-text mr-2 text-primary"></i>文本数据
          </h2>
          <div class="flex gap-2">
            <button id="copyTextBtn" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-all-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              <i class="fa fa-copy"></i>
            </button>
            <button id="clearTextBtn" class="p-2 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-700 transition-all-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
              <i class="fa fa-times"></i>
            </button>
          </div>
        </div>
        <textarea id="textData" class="w-full h-60 p-3 border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-900 resize-none scrollbar-thin" placeholder="数据将显示在这里..." readonly></textarea>
      </div>
    </div>

    <!-- 右侧面板 -->
    <div class="lg:w-3/4 space-y-6">
      <!-- 标题区域 -->
      <div class="mb-4 text-center">
        <div class="inline-block px-4 py-1 bg-primary-light dark:bg-blue-900/30 rounded-full text-primary dark:text-blue-300 text-sm font-medium mb-3">
          创新点2
        </div>
        <h1 class="text-2xl md:text-3xl font-bold mb-2">基于语义嵌入网络的跨领域复杂设计知识关联挖掘与分析</h1>
        <p class="text-gray-600 dark:text-gray-400">提升了跨领域知识检索的准确率与知识复用效率</p>
      </div>

      <!-- 主要内容卡片 -->
      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-card p-6 transition-all-300 hover:shadow-card-hover mb-6">
        <!-- 技术实现与应用效果标签页 -->
        <div class="flex border-b border-gray-200 dark:border-gray-700 mb-6">
          <button id="techTab" class="px-6 py-3 font-medium text-primary border-b-2 border-primary">
            技术实现
          </button>
          <button id="effectTab" class="px-6 py-3 font-medium text-gray-500 dark:text-gray-400 hover:text-primary dark:hover:text-primary">
            应用效果
          </button>
        </div>

        <!-- 内容区域 -->
        <div id="mainContentArea" class="hidden">
          <!-- 知识网络可视化 -->
          <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-4 mb-6">
            <h3 class="text-lg font-semibold mb-3 text-center">跨领域设计知识关联网络</h3>
            <div id="knowledgeNetwork" class="w-full h-[500px]"></div>
          </div>

          <!-- 技术实现和应用效果内容 -->
          <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- 左侧内容 - 技术实现 -->
            <div id="techContent">
              <div class="bg-primary-light dark:bg-blue-900/20 rounded-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-primary dark:text-blue-300">基于多维度知识表示的个性化知识推荐</h3>
                <div class="space-y-4">
                  <div class="flex items-start">
                    <div class="bg-primary text-white rounded-full w-6 h-6 flex items-center justify-center mr-3 mt-0.5 flex-shrink-0">1</div>
                    <p>构建多源异构知识图谱，整合产品设计领域的结构化和非结构化知识</p>
                  </div>
                  <div class="flex items-start">
                    <div class="bg-primary text-white rounded-full w-6 h-6 flex items-center justify-center mr-3 mt-0.5 flex-shrink-0">2</div>
                    <p>基于深度学习的语义嵌入模型，将知识实体和关系映射到低维向量空间</p>
                  </div>
                  <div class="flex items-start">
                    <div class="bg-primary text-white rounded-full w-6 h-6 flex items-center justify-center mr-3 mt-0.5 flex-shrink-0">3</div>
                    <p>设计注意力机制，捕捉用户兴趣和上下文信息，实现个性化知识推荐</p>
                  </div>
                </div>
              </div>
              
              <div class="bg-secondary-light dark:bg-green-900/20 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4 text-secondary dark:text-green-300">知识图谱构建流程</h3>
                <div class="relative pl-8 before:content-[''] before:absolute before:left-3 before:top-0 before:bottom-0 before:w-0.5 before:bg-secondary before:opacity-30">
                  <div class="mb-6 relative">
                    <div class="absolute -left-8 top-1 w-6 h-6 rounded-full bg-secondary flex items-center justify-center text-white">
                      <i class="fa fa-database"></i>
                    </div>
                    <h4 class="font-medium text-secondary">知识抽取</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">从多源数据中抽取实体、关系和属性</p>
                  </div>
                  <div class="mb-6 relative">
                    <div class="absolute -left-8 top-1 w-6 h-6 rounded-full bg-secondary flex items-center justify-center text-white">
                      <i class="fa fa-puzzle-piece"></i>
                    </div>
                    <h4 class="font-medium text-secondary">知识融合</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">消除冗余和冲突，形成统一的知识表示</p>
                  </div>
                  <div class="relative">
                    <div class="absolute -left-8 top-1 w-6 h-6 rounded-full bg-secondary flex items-center justify-center text-white">
                      <i class="fa fa-cogs"></i>
                    </div>
                    <h4 class="font-medium text-secondary">知识推理</h4>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mt-1">基于规则和机器学习方法进行知识推理和补全</p>
                  </div>
                </div>
              </div>
            </div>

            <!-- 右侧内容 - 应用效果 -->
            <div id="effectContent" class="hidden">
              <div class="bg-accent-light dark:bg-orange-900/20 rounded-lg p-6 mb-6">
                <h3 class="text-lg font-semibold mb-4 text-accent dark:text-orange-300">关键成果</h3>
                <ul class="space-y-3">
                  <li class="flex items-start">
                    <i class="fa fa-check-circle text-accent mr-2 mt-1"></i>
                    <span>构建了10个以上的设计知识模型</span>
                  </li>
                  <li class="flex items-start">
                    <i class="fa fa-check-circle text-accent mr-2 mt-1"></i>
                    <span>设计知识匹配准确率提升35%</span>
                  </li>
                  <li class="flex items-start">
                    <i class="fa fa-check-circle text-accent mr-2 mt-1"></i>
                    <span>创新灵感挖掘效率提高40%</span>
                  </li>
                </ul>
              </div>
              
              <div class="bg-gray-100 dark:bg-gray-700 rounded-lg p-6">
                <h3 class="text-lg font-semibold mb-4">应用场景</h3>
                <div class="grid grid-cols-2 gap-4">
                  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm">
                    <div class="flex items-center mb-2">
                      <i class="fa fa-lightbulb-o text-yellow-500 mr-2"></i>
                      <h4 class="font-medium">创新设计</h4>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400">辅助设计师快速获取跨领域创新灵感</p>
                  </div>
                  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm">
                    <div class="flex items-center mb-2">
                      <i class="fa fa-search text-blue-500 mr-2"></i>
                      <h4 class="font-medium">知识检索</h4>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400">提高跨领域知识检索的准确性和效率</p>
                  </div>
                  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm">
                    <div class="flex items-center mb-2">
                      <i class="fa fa-users text-green-500 mr-2"></i>
                      <h4 class="font-medium">团队协作</h4>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400">促进多学科团队间的知识共享和协作</p>
                  </div>
                  <div class="bg-white dark:bg-gray-800 rounded-lg p-4 shadow-sm">
                    <div class="flex items-center mb-2">
                      <i class="fa fa-graduation-cap text-purple-500 mr-2"></i>
                      <h4 class="font-medium">人才培养</h4>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400">加速新手设计师的知识学习和技能提升</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- 初始提示区域 -->
        <div id="initialPromptArea" class="flex flex-col items-center justify-center py-16">
          <div class="w-24 h-24 rounded-full bg-primary-light dark:bg-blue-900/30 flex items-center justify-center text-primary mb-6">
            <i class="fa fa-bar-chart text-4xl"></i>
          </div>
          <h3 class="text-xl font-semibold mb-3 text-center">准备生成知识关联网络</h3>
          <p class="text-gray-600 dark:text-gray-400 text-center max-w-md">
            请在左侧面板上传数据文件或加载示例数据，然后点击"生成知识关联图表"按钮以显示知识关联网络可视化
          </p>
        </div>
      </div>

      <!-- 数据统计卡片 -->
      <div id="statsCards" class="hidden grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-card p-6 transition-all-300 hover:shadow-card-hover">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">知识模型数量</h3>
            <div class="w-10 h-10 rounded-full bg-primary-light dark:bg-blue-900/30 flex items-center justify-center text-primary">
              <i class="fa fa-cubes"></i>
            </div>
          </div>
          <div class="flex items-end">
            <span class="text-3xl font-bold">12</span>
            <span class="text-gray-500 dark:text-gray-400 ml-2 mb-1">个</span>
          </div>
          <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">较传统方法增加 <span class="text-green-500">20%</span></div>
        </div>
        
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-card p-6 transition-all-300 hover:shadow-card-hover">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">匹配准确率</h3>
            <div class="w-10 h-10 rounded-full bg-secondary-light dark:bg-green-900/30 flex items-center justify-center text-secondary">
              <i class="fa fa-bullseye"></i>
            </div>
          </div>
          <div class="flex items-end">
            <span class="text-3xl font-bold">85%</span>
            <span class="text-gray-500 dark:text-gray-400 ml-2 mb-1">+35%</span>
          </div>
          <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">较传统方法提升 <span class="text-green-500">35%</span></div>
        </div>
        
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-card p-6 transition-all-300 hover:shadow-card-hover">
          <div class="flex items-center justify-between mb-4">
            <h3 class="text-lg font-semibold">挖掘效率</h3>
            <div class="w-10 h-10 rounded-full bg-accent-light dark:bg-orange-900/30 flex items-center justify-center text-accent">
              <i class="fa fa-bolt"></i>
            </div>
          </div>
          <div class="flex items-end">
            <span class="text-3xl font-bold">40%</span>
            <span class="text-gray-500 dark:text-gray-400 ml-2 mb-1">提升</span>
          </div>
          <div class="mt-2 text-sm text-gray-500 dark:text-gray-400">创新灵感挖掘效率提高 <span class="text-green-500">40%</span></div>
        </div>
      </div>

      <!-- 技术特点卡片 -->
      <div id="techFeaturesCard" class="hidden bg-white dark:bg-gray-800 rounded-xl shadow-card p-6 transition-all-300 hover:shadow-card-hover">
        <h2 class="text-xl font-bold mb-6 text-center">核心技术特点</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
          <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-4 text-center">
            <div class="w-12 h-12 rounded-full bg-primary-light dark:bg-blue-900/30 flex items-center justify-center text-primary mx-auto mb-3">
              <i class="fa fa-sitemap text-xl"></i>
            </div>
            <h3 class="font-semibold mb-2">多维度知识表示</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">融合结构、语义和上下文信息的知识表示方法</p>
          </div>
          
          <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-4 text-center">
            <div class="w-12 h-12 rounded-full bg-secondary-light dark:bg-green-900/30 flex items-center justify-center text-secondary mx-auto mb-3">
              <i class="fa fa-exchange text-xl"></i>
            </div>
            <h3 class="font-semibold mb-2">跨领域关联挖掘</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">发现不同领域间隐藏的知识关联和迁移机会</p>
          </div>
          
          <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-4 text-center">
            <div class="w-12 h-12 rounded-full bg-accent-light dark:bg-orange-900/30 flex items-center justify-center text-accent mx-auto mb-3">
              <i class="fa fa-user-circle text-xl"></i>
            </div>
            <h3 class="font-semibold mb-2">个性化推荐</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">基于用户兴趣和上下文的精准知识推荐</p>
          </div>
          
          <div class="bg-gray-50 dark:bg-gray-900 rounded-lg p-4 text-center">
            <div class="w-12 h-12 rounded-full bg-purple-100 dark:bg-purple-900/30 flex items-center justify-center text-purple-600 dark:text-purple-300 mx-auto mb-3">
              <i class="fa fa-line-chart text-xl"></i>
            </div>
            <h3 class="font-semibold mb-2">智能分析</h3>
            <p class="text-sm text-gray-600 dark:text-gray-400">知识演化趋势分析和创新机会预测</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- 页脚 -->
  <footer class="bg-white dark:bg-gray-800 shadow-inner py-4">
    <div class="container mx-auto px-4 text-center text-gray-600 dark:text-gray-400 text-sm">
      <p>© 2025 知识关联挖掘与分析系统 | 设计与开发</p>
    </div>
  </footer>

  <!-- 通知组件 -->
  <div id="notification" class="fixed top-4 right-4 max-w-sm bg-white dark:bg-gray-800 rounded-lg shadow-lg p-4 transform translate-x-full transition-transform duration-300 flex items-start z-50">
    <div id="notificationIcon" class="text-xl mr-3"></div>
    <div class="flex-1">
      <h3 id="notificationTitle" class="font-semibold"></h3>
      <p id="notificationMessage" class="text-sm text-gray-600 dark:text-gray-400 mt-1"></p>
    </div>
    <button id="closeNotification" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
      <i class="fa fa-times"></i>
    </button>
  </div>

  <script>
    // DOM元素 - 左侧文件上传相关
    const dropArea = document.getElementById('dropArea');
    const fileInput = document.getElementById('fileInput');
    const loadExampleBtn = document.getElementById('loadExampleBtn');
    const clearDataBtn = document.getElementById('clearDataBtn');
    const generateChartBtn = document.getElementById('generateChartBtn');
    const dataTree = document.getElementById('dataTree');
    const textData = document.getElementById('textData');
    const copyTextBtn = document.getElementById('copyTextBtn');
    const clearTextBtn = document.getElementById('clearTextBtn');
    
    // DOM元素 - 右侧知识关联相关
    const themeToggle = document.getElementById('themeToggle');
    const techTab = document.getElementById('techTab');
    const effectTab = document.getElementById('effectTab');
    const techContent = document.getElementById('techContent');
    const effectContent = document.getElementById('effectContent');
    const knowledgeNetwork = document.getElementById('knowledgeNetwork');
    const mainContentArea = document.getElementById('mainContentArea');
    const initialPromptArea = document.getElementById('initialPromptArea');
    const statsCards = document.getElementById('statsCards');
    const techFeaturesCard = document.getElementById('techFeaturesCard');
    
    // DOM元素 - 通知组件
    const notification = document.getElementById('notification');
    const notificationIcon = document.getElementById('notificationIcon');
    const notificationTitle = document.getElementById('notificationTitle');
    const notificationMessage = document.getElementById('notificationMessage');
    const closeNotification = document.getElementById('closeNotification');

    // 全局变量
    let processedData = {
      dates: [],
      values: [],
      raw: ''
    };
    let myChart = null;

    // 初始化
    document.addEventListener('DOMContentLoaded', () => {
      // 初始化主题
      initTheme();
      
      // 初始化事件监听
      initEventListeners();
    });

    // 初始化主题
    function initTheme() {
      if (localStorage.getItem('theme') === 'dark' || 
          (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
        document.documentElement.classList.add('dark');
      } else {
        document.documentElement.classList.remove('dark');
      }
    }

    // 初始化事件监听
    function initEventListeners() {
      // 主题切换
      themeToggle.addEventListener('click', toggleTheme);
      
      // 标签页切换
      techTab.addEventListener('click', () => switchTab('tech'));
      effectTab.addEventListener('click', () => switchTab('effect'));
      
      // 文件上传区域事件
      dropArea.addEventListener('click', () => fileInput.click());
      dropArea.addEventListener('dragover', handleDragOver);
      dropArea.addEventListener('drop', handleDrop);
      fileInput.addEventListener('change', handleFileSelect);
      
      // 按钮事件
      loadExampleBtn.addEventListener('click', loadExampleData);
      clearDataBtn.addEventListener('click', clearData);
      generateChartBtn.addEventListener('click', generateChart);
      copyTextBtn.addEventListener('click', copyTextToClipboard);
      clearTextBtn.addEventListener('click', clearTextArea);
      
      // 通知关闭按钮
      closeNotification.addEventListener('click', hideNotification);
    }

    // 切换主题
    function toggleTheme() {
      if (document.documentElement.classList.contains('dark')) {
        document.documentElement.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      } else {
        document.documentElement.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      }
      
      // 如果图表已生成，重新初始化以适应新主题
      if (myChart) {
        initKnowledgeNetwork();
      }
    }

    // 切换标签页
    function switchTab(tab) {
      if (tab === 'tech') {
        techTab.classList.add('text-primary', 'border-primary');
        techTab.classList.remove('text-gray-500', 'dark:text-gray-400');
        effectTab.classList.remove('text-primary', 'border-primary');
        effectTab.classList.add('text-gray-500', 'dark:text-gray-400');
        techContent.classList.remove('hidden');
        effectContent.classList.add('hidden');
      } else {
        effectTab.classList.add('text-primary', 'border-primary');
        effectTab.classList.remove('text-gray-500', 'dark:text-gray-400');
        techTab.classList.remove('text-primary', 'border-primary');
        techTab.classList.add('text-gray-500', 'dark:text-gray-400');
        effectContent.classList.remove('hidden');
        techContent.classList.add('hidden');
      }
    }

    // 处理拖拽经过
    function handleDragOver(e) {
      e.preventDefault();
      dropArea.classList.add('border-primary');
    }

    // 处理拖拽放置
    function handleDrop(e) {
      e.preventDefault();
      dropArea.classList.remove('border-primary');
      
      if (e.dataTransfer.files.length) {
        handleFiles(e.dataTransfer.files);
      }
    }

    // 处理文件选择
    function handleFileSelect(e) {
      if (e.target.files.length) {
        handleFiles(e.target.files);
      }
    }

    // 处理文件
    function handleFiles(files) {
      const file = files[0];
      
      // 验证文件类型
      if (!['text/plain', 'text/csv', 'application/json'].includes(file.type) &&
          !file.name.endsWith('.txt') && !file.name.endsWith('.csv') && !file.name.endsWith('.json')) {
        showNotification('错误', '请上传.txt, .csv或.json格式的文件', 'error');
        return;
      }
      
      const reader = new FileReader();
      
      reader.onload = function(e) {
        try {
          const content = e.target.result;
          processedData.raw = content;
          
          // 解析文件内容
          parseFileContent(file, content);
          
          // 更新UI
          updateDataTree();
          updateTextArea();
          
          // 启用按钮
          copyTextBtn.disabled = false;
          clearTextBtn.disabled = false;
          generateChartBtn.disabled = false;
          
          showNotification('成功', '文件上传并解析成功', 'success');
        } catch (error) {
          showNotification('错误', `文件解析失败: ${error.message}`, 'error');
        }
      };
      
      reader.onerror = function() {
        showNotification('错误', '文件读取失败', 'error');
      };
      
      reader.readAsText(file);
    }

    // 解析文件内容
    function parseFileContent(file, content) {
      if (file.name.endsWith('.txt')) {
        // 解析TXT文件（每行一个数据点，格式：日期,数值）
        const lines = content.split('\n').filter(line => line.trim() !== '');
        processedData.dates = [];
        processedData.values = [];
        
        lines.forEach(line => {
          const parts = line.split(',');
          if (parts.length === 2) {
            processedData.dates.push(parts[0].trim());
            processedData.values.push(parseFloat(parts[1].trim()));
          }
        });
        
        if (processedData.dates.length === 0) {
          throw new Error('TXT文件格式不正确，请确保每行格式为：日期,数值');
        }
      } else if (file.name.endsWith('.csv')) {
        // 解析CSV文件（第一行为标题，后续行为数据）
        const lines = content.split('\n').filter(line => line.trim() !== '');
        if (lines.length < 2) {
          throw new Error('CSV文件至少需要包含标题行和一行数据');
        }
        
        // 假设第一列为日期，第二列为数值
        processedData.dates = [];
        processedData.values = [];
        
        for (let i = 1; i < lines.length; i++) {
          const parts = lines[i].split(',');
          if (parts.length >= 2) {
            processedData.dates.push(parts[0].trim());
            processedData.values.push(parseFloat(parts[1].trim()));
          }
        }
        
        if (processedData.dates.length === 0) {
          throw new Error('CSV文件格式不正确，请确保包含日期和数值列');
        }
      } else if (file.name.endsWith('.json')) {
        // 解析JSON文件（格式：{ "dates": [], "values": [] }）
        const jsonData = JSON.parse(content);
        
        if (!jsonData.dates || !jsonData.values || !Array.isArray(jsonData.dates) || !Array.isArray(jsonData.values)) {
          throw new Error('JSON文件格式不正确，请确保包含dates和values数组');
        }
        
        if (jsonData.dates.length !== jsonData.values.length) {
          throw new Error('dates和values数组长度必须一致');
        }
        
        processedData.dates = jsonData.dates;
        processedData.values = jsonData.values.map(v => parseFloat(v));
      } else {
        throw new Error('不支持的文件格式');
      }
    }

    // 加载示例数据
    function loadExampleData() {
      // 生成过去30天的示例数据
      const today = new Date();
      processedData.dates = [];
      processedData.values = [];
      
      for (let i = 29; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(today.getDate() - i);
        processedData.dates.push(date.toISOString().split('T')[0]);
        
        // 生成随机数值，带有一定的趋势性
        const trend = i * 0.5; // 整体上升趋势
        const random = Math.random() * 10; // 随机波动
        processedData.values.push(Math.round((20 + trend + random) * 10) / 10);
      }
      
      // 生成原始数据文本
      processedData.raw = processedData.dates.map((date, index) => `${date},${processedData.values[index]}`).join('\n');
      
      // 更新UI
      updateDataTree();
      updateTextArea();
      
      // 启用按钮
      copyTextBtn.disabled = false;
      clearTextBtn.disabled = false;
      generateChartBtn.disabled = false;
      
      showNotification('示例数据已加载', '数据已显示在文本区域和结构树中', 'success');
    }

    // 清空数据
    function clearData() {
      // 清空数据
      processedData = {
        dates: [],
        values: [],
        raw: ''
      };
      
      // 更新UI
      updateDataTree();
      updateTextArea();
      
      // 禁用按钮
      copyTextBtn.disabled = true;
      clearTextBtn.disabled = true;
      generateChartBtn.disabled = true;
      
      // 隐藏图表和相关内容
      if (myChart) {
        myChart.dispose();
        myChart = null;
      }
      
      mainContentArea.classList.add('hidden');
      initialPromptArea.classList.remove('hidden');
      statsCards.classList.add('hidden');
      techFeaturesCard.classList.add('hidden');
      
      showNotification('数据已清空', '', 'info');
    }

    // 生成图表
    function generateChart() {
      if (processedData.dates.length === 0 || processedData.values.length === 0) {
        showNotification('错误', '没有可用的数据生成图表', 'error');
        return;
      }
      
      // 显示图表区域，隐藏初始提示
      mainContentArea.classList.remove('hidden');
      initialPromptArea.classList.add('hidden');
      statsCards.classList.remove('hidden');
      techFeaturesCard.classList.remove('hidden');
      
      // 初始化知识网络可视化
      initKnowledgeNetwork();
      
      showNotification('图表生成成功', '知识关联网络已显示在右侧', 'success');
    }

    // 更新数据结构树
    function updateDataTree() {
      if (processedData.dates.length === 0 || processedData.values.length === 0) {
        dataTree.innerHTML = '<p class="text-gray-500 dark:text-gray-400 text-center italic">暂无数据</p>';
        return;
      }
      
      // 创建数据树
      let treeHTML = `
        <div class="tree-item">
          <div class="flex items-center cursor-pointer tree-toggle">
            <i class="fa fa-folder-open text-yellow-500 mr-2"></i>
            <span>数据</span>
          </div>
          <div class="ml-6 mt-2">
      `;
      
      // 添加日期节点
      treeHTML += `
        <div class="tree-item">
          <div class="flex items-center cursor-pointer tree-toggle">
            <i class="fa fa-calendar text-blue-500 mr-2"></i>
            <span>日期 (${processedData.dates.length})</span>
          </div>
          <div class="ml-6 mt-2">
      `;
      
      // 添加前5个日期作为示例
      const datesToShow = processedData.dates.slice(0, 5);
      datesToShow.forEach(date => {
        treeHTML += `
          <div class="tree-item">
            <div class="flex items-center">
              <i class="fa fa-calendar-o text-gray-500 mr-2"></i>
              <span>${date}</span>
            </div>
          </div>
        `;
      });
      
      // 如果有更多日期，显示省略号
      if (processedData.dates.length > 5) {
        treeHTML += `
          <div class="tree-item">
            <div class="flex items-center text-gray-500">
              <i class="fa fa-ellipsis-h mr-2"></i>
              <span>还有 ${processedData.dates.length - 5} 个日期...</span>
            </div>
          </div>
        `;
      }
      
      treeHTML += `
          </div>
        </div>
      `;
      
      // 添加数值节点
      treeHTML += `
        <div class="tree-item">
          <div class="flex items-center cursor-pointer tree-toggle">
            <i class="fa fa-line-chart text-green-500 mr-2"></i>
            <span>数值 (${processedData.values.length})</span>
          </div>
          <div class="ml-6 mt-2">
      `;
      
      // 添加前5个数值作为示例
      const valuesToShow = processedData.values.slice(0, 5);
      valuesToShow.forEach(value => {
        treeHTML += `
          <div class="tree-item">
            <div class="flex items-center">
              <i class="fa fa-circle text-xs text-gray-500 mr-2"></i>
              <span>${value}</span>
            </div>
          </div>
        `;
      });
      
      // 如果有更多数值，显示省略号
      if (processedData.values.length > 5) {
        treeHTML += `
          <div class="tree-item">
            <div class="flex items-center text-gray-500">
              <i class="fa fa-ellipsis-h mr-2"></i>
              <span>还有 ${processedData.values.length - 5} 个数值...</span>
            </div>
          </div>
        `;
      }
      
      treeHTML += `
          </div>
        </div>
      `;
      
      treeHTML += `
          </div>
        </div>
      `;
      
      dataTree.innerHTML = treeHTML;
      
      // 添加树节点展开/折叠功能
      document.querySelectorAll('.tree-toggle').forEach(toggle => {
        toggle.addEventListener('click', function() {
          const content = this.nextElementSibling;
          const icon = this.querySelector('i');
          
          if (content.style.display === 'none') {
            content.style.display = 'block';
            icon.classList.remove('fa-folder');
            icon.classList.add('fa-folder-open');
          } else {
            content.style.display = 'none';
            icon.classList.remove('fa-folder-open');
            icon.classList.add('fa-folder');
          }
        });
      });
    }

    // 更新文本区域
    function updateTextArea() {
      textData.value = processedData.raw || '暂无数据';
    }

    // 复制文本到剪贴板
    function copyTextToClipboard() {
      if (!processedData.raw) {
        showNotification('提示', '没有可复制的文本', 'info');
        return;
      }
      
      textData.select();
      document.execCommand('copy');
      
      showNotification('成功', '文本已复制到剪贴板', 'success');
    }

    // 清空文本区域
    function clearTextArea() {
      textData.value = '';
      showNotification('提示', '文本区域已清空', 'info');
    }

    // 初始化知识网络可视化
    function initKnowledgeNetwork() {
      // 初始化ECharts实例
      myChart = echarts.init(knowledgeNetwork);
      
      // 监听窗口大小变化，调整图表大小
      window.addEventListener('resize', () => {
        myChart.resize();
      });
      
      // 生成模拟数据
      const categories = [
        { name: '产品设计知识' },
        { name: '工程知识' },
        { name: '材料知识' },
        { name: '制造知识' },
        { name: '用户知识' }
      ];
      
      const nodes = [
        { id: 0, name: '产品设计', symbolSize: 30, category: 0, value: 30 },
        { id: 1, name: '结构设计', symbolSize: 25, category: 0, value: 25 },
        { id: 2, name: '外观设计', symbolSize: 22, category: 0, value: 22 },
        { id: 3, name: '机械工程', symbolSize: 28, category: 1, value: 28 },
        { id: 4, name: '电子工程', symbolSize: 24, category: 1, value: 24 },
        { id: 5, name: '材料科学', symbolSize: 26, category: 2, value: 26 },
        { id: 6, name: '金属材料', symbolSize: 18, category: 2, value: 18 },
        { id: 7, name: '高分子材料', symbolSize: 19, category: 2, value: 19 },
        { id: 8, name: '智能制造', symbolSize: 27, category: 3, value: 27 },
        { id: 9, name: '工艺优化', symbolSize: 20, category: 3, value: 20 },
        { id: 10, name: '用户需求', symbolSize: 29, category: 4, value: 29 },
        { id: 11, name: '用户体验', symbolSize: 23, category: 4, value: 23 }
      ];
      
      const links = [
        { source: 0, target: 1, value: 5 },
        { source: 0, target: 2, value: 8 },
        { source: 0, target: 3, value: 3 },
        { source: 0, target: 10, value: 10 },
        { source: 1, target: 3, value: 7 },
        { source: 1, target: 5, value: 6 },
        { source: 1, target: 8, value: 4 },
        { source: 2, target: 7, value: 5 },
        { source: 2, target: 11, value: 9 },
        { source: 3, target: 4, value: 3 },
        { source: 3, target: 8, value: 6 },
        { source: 4, target: 8, value: 7 },
        { source: 5, target: 6, value: 8 },
        { source: 5, target: 7, value: 7 },
        { source: 6, target: 8, value: 4 },
        { source: 7, target: 9, value: 5 },
        { source: 8, target: 9, value: 9 },
        { source: 10, target: 11, value: 8 },
        { source: 0, target: 5, value: 2 },
        { source: 3, target: 6, value: 1 },
        { source: 4, target: 7, value: 2 },
        { source: 9, target: 11, value: 3 }
      ];
      
      // 图表配置
      const option = {
        backgroundColor: 'transparent',
        tooltip: {
          trigger: 'item',
          formatter: function(params) {
            if (params.dataType === 'node') {
              return `${params.data.name}<br/>关联度: ${params.data.value}`;
            } else {
              return `${params.data.source} -> ${params.data.target}<br/>关联强度: ${params.data.value}`;
            }
          }
        },
        legend: {
          data: categories.map(a => a.name),
          orient: 'horizontal',
          bottom: 10,
          textStyle: {
            color: document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#1a202c'
          }
        },
        animationDuration: 1500,
        animationEasingUpdate: 'quinticInOut',
        series: [{
          name: '知识关联网络',
          type: 'graph',
          layout: 'force',
          data: nodes,
          links: links,
          categories: categories,
          roam: true,
          label: {
            show: true,
            position: 'right',
            formatter: '{b}',
            color: document.documentElement.classList.contains('dark') ? '#e2e8f0' : '#1a202c'
          },
          force: {
            repulsion: 200,
            gravity: 0.1,
            edgeLength: [50, 100],
            layoutAnimation: true
          },
          lineStyle: {
            color: 'source',
            curveness: 0.3,
            width: function(params) {
              return params.data.value / 2;
            }
          },
          emphasis: {
            focus: 'adjacency',
            lineStyle: {
              width: 6
            }
          }
        }]
      };
      
      // 设置图表
      myChart.setOption(option);
    }

    // 显示通知
    function showNotification(title, message, type = 'info') {
      // 设置通知类型
      let iconClass = 'fa-info-circle text-info';
      if (type === 'success') {
        iconClass = 'fa-check-circle text-success';
      } else if (type === 'error') {
        iconClass = 'fa-exclamation-circle text-danger';
      } else if (type === 'warning') {
        iconClass = 'fa-exclamation-triangle text-warning';
      }
      
      // 设置通知内容
      notificationIcon.className = iconClass;
      notificationTitle.textContent = title;
      notificationMessage.textContent = message;
      
      // 显示通知
      notification.classList.remove('translate-x-full');
      
      // 3秒后自动隐藏
      setTimeout(hideNotification, 3000);
    }

    // 隐藏通知
    function hideNotification() {
      notification.classList.add('translate-x-full');
    }
  </script>
</body>
</html>
  
