<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="fun.server.mapper.TMajorMapper">
  <resultMap id="BaseResultMap" type="fun.server.model.TMajor">
    <!--
    @mbg.generated
    -->
    <constructor>
      <idArg column="FKeyID" javaType="java.lang.Long" jdbcType="BIGINT" />
      <arg column="FCID" javaType="java.lang.Long" jdbcType="BIGINT" />
      <arg column="FUID" javaType="java.lang.Long" jdbcType="BIGINT" />
      <arg column="FCDATE" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="FUDATE" javaType="java.util.Date" jdbcType="TIMESTAMP" />
      <arg column="FState" javaType="java.lang.Integer" jdbcType="INTEGER" />
      <arg column="FMajorName" javaType="java.lang.String" jdbcType="VARCHAR" />
      <arg column="FCollegeID" javaType="java.lang.Long" jdbcType="BIGINT" />
    </constructor>
  </resultMap>
  <sql id="Example_Where_Clause">
    <!--
    @mbg.generated
    -->
    <where>
      <foreach collection="oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Update_By_Example_Where_Clause">
    <!--
    @mbg.generated
    -->
    <where>
      <foreach collection="example.oredCriteria" item="criteria" separator="or">
        <if test="criteria.valid">
          <trim prefix="(" prefixOverrides="and" suffix=")">
            <foreach collection="criteria.criteria" item="criterion">
              <choose>
                <when test="criterion.noValue">
                  and ${criterion.condition}
                </when>
                <when test="criterion.singleValue">
                  and ${criterion.condition} #{criterion.value}
                </when>
                <when test="criterion.betweenValue">
                  and ${criterion.condition} #{criterion.value} and #{criterion.secondValue}
                </when>
                <when test="criterion.listValue">
                  and ${criterion.condition}
                  <foreach close=")" collection="criterion.value" item="listItem" open="(" separator=",">
                    #{listItem}
                  </foreach>
                </when>
              </choose>
            </foreach>
          </trim>
        </if>
      </foreach>
    </where>
  </sql>
  <sql id="Base_Column_List">
    <!--
    @mbg.generated
    -->
    FKeyID, FCID, FUID, FCDATE, FUDATE, FState, FMajorName, FCollegeID
  </sql>
  <select id="selectTGrade" parameterType="fun.server.model.customQuery.major.TMajorCS" resultType="fun.server.model.customQuery.major.TMajorData">
--     SELECT IFNULL(tc.FKeyID,0) AS FKeyID,IFNULL(tg.FKeyID,0) AS FGradeID,IFNULL(tg.FGradeName,'') AS FGradeName,IFNULL(tg.FAdmissionYear,0) AS FAdmissionYear
--     ,IFNULL(tc.FClassName,'') AS  FClassName,CONCAT(tg.FGradeName,'' ,tc.FClassName ) AS FName,IFNULL(tc.FKeyID,0) AS FCLassID,IFNULL(tc.FMajorID,0) AS FMajorID
--     FROM t_class tc
--     LEFT JOIN t_grade tg
--     ON tc.FGradeID = tg.FKeyID
--     where 1=1
    SELECT IFNULL(tc.FKeyID,0) AS FKeyID,IFNULL(tg.FKeyID,0) AS FGradeID,IFNULL(tg.FGradeName,'') AS FGradeName,IFNULL(tg.FAdmissionYear,0) AS FAdmissionYear
    ,IFNULL(tc.FClassName,'') AS  FClassName
    ,CONCAT(tg.FGradeName,tg.`FMonth`,'月',
    CASE
    WHEN tg.`FSeason` = 1 THEN '春'
    WHEN tg.`FSeason` = 2 THEN '秋'
    END,
    '' ,tmj.FMajorName,tc.FClassName ) AS FName,IFNULL(tc.FKeyID,0) AS FCLassID,IFNULL(tc.FMajorID,0) AS FMajorID
    FROM t_class tc
    LEFT JOIN t_grade tg
    ON tc.FGradeID = tg.FKeyID
    LEFT JOIN t_major tmj
    ON tc.FMajorID = tmj.FKeyID
    WHERE 1=1
    <choose>
      <when test="FMajorID != null and FMajorID!=''">
        and tc.FMajorID = #{FMajorID}
      </when>
      <otherwise>
        and tc.FMajorID = 0
      </otherwise>
    </choose>
    <if test="orderBy != null and orderBy!=''">
      order by ${orderBy}
    </if>
  </select>

  <select id="selectclassstudent" parameterType="fun.server.model.customQuery.major.TMajorCS" resultType="fun.server.model.customQuery.major.TClassStudentData">
      SELECT tcs.FKeyID,tstu.FKeyID as FStudentID,IFNULL(tstu.FName,'') AS FName,IFNULL(tstu.FNo,'') AS
      FNo,tstu.FSex,tstu.FBirthday,IFNULL(tstu.FTel,'') AS FTel
      FROM t_class_student tcs
      LEFT JOIN t_class tc
      ON tcs.FClassID = tc.FKeyID
      LEFT JOIN t_student tstu
      ON tstu.FKeyID = tcs.FStudentID
      where 1=1
      <choose>
          <when test="FMajorID != null and FMajorID!=''">
              and tcs.FClassID = #{FMajorID}
          </when>
          <otherwise>
              and tcs.FClassID = 0
          </otherwise>
      </choose>
      <if test="FName != null and FName!=''">
          and tstu.FName LIKE concat('%',#{FName},'%')
      </if>

      <if test="FNo != null and FNo!=''">
          and tstu.FNo LIKE concat('%',#{FNo},'%')
      </if>

      <if test="FSex != null and FSex!=''">
          and tstu.FSex = ${FSex}
    </if>

      <if test="FTel != null and FTel!=''">
          and tstu.FTel LIKE concat('%',#{FTel},'%')
      </if>
      <if test="orderBy != null and orderBy!=''">
          order by ${orderBy}
      </if>
  </select>

  <select id="classstudentSelect" parameterType="fun.server.model.customQuery.major.TClassStudentCS" resultType="fun.server.model.customQuery.major.TClassStudentData">
    SELECT s.FKeyID,s.FName
    FROM t_student s
    WHERE NOT EXISTS (
    SELECT 1
    FROM t_class_student cs
    WHERE cs.FStudentID = s.FKeyID
    )
    <if test="FName != null and FName!=''">
      and s.FName like concat('%',#{FName},'%')
    </if>
    <if test=" FState != null and FState!= -1 ">
      and s.FState = #{FState}
    </if>
    <if test="orderBy != null and orderBy!=''">
      order by ${orderBy}
    </if>
  </select>

  <select id="selectClassInfo" parameterType="fun.server.model.customQuery.major.TClassCS" resultType="fun.server.model.customQuery.major.TCLassData">
--     SELECT tc.FKeyID AS FClassID,CONCAT(tg.FGradeName,'' ,tc.FClassName ) AS FClassName FROM t_class_student tcs
--     LEFT JOIN t_class tc
--     ON tcs.FClassID = tc.FKeyID
--     LEFT JOIN t_grade tg
--     ON tc.FGradeID = tg.FKeyID
--     WHERE 1 =1
      SELECT tc.FKeyID AS FClassID
      ,CONCAT(tg.FGradeName,tg.FMonth,'月',
      CASE
      WHEN tg.FSeason = 1 THEN '春'
      WHEN tg.FSeason = 2 THEN '秋'
      END,
      '' ,tmj.FMajorName,tc.FClassName )AS FClassName FROM t_class_student tcs
      LEFT JOIN t_class tc
      ON tcs.FClassID = tc.FKeyID
      LEFT JOIN t_grade tg
      ON tc.FGradeID = tg.FKeyID
      LEFT JOIN t_major tmj
      ON tc.FMajorID = tmj.FKeyID
      WHERE 1 =1
    <choose>
      <when test="FStudentID != null and FStudentID!=''">
        and tcs.FStudentID = #{FStudentID}
      </when>
      <otherwise>
        and tcs.FStudentID = 0
      </otherwise>
    </choose>
    <if test="orderBy != null and orderBy!=''">
      order by ${orderBy}
    </if>
  </select>
  <select id="queryDatamajorSelect" parameterType="fun.server.model.customQuery.major.TMajorCS" resultType="fun.server.model.customQuery.major.TMajorData">
    SELECT tm.FKeyID,CONCAT(tc.`FCollegeName`, '/', tm.`FMajorName`) AS FName  FROM `t_major` tm
    LEFT JOIN `t_college` tc
    ON tm.`FCollegeID` = tc.`FKeyID`
    WHERE tm.FState = 1
    <if test="FName != null and FName!=''">
      AND tm.FMajorName LIKE concat('%',#{FName},'%') OR tc.FCollegeName LIKE concat('%',#{FName},'%')
    </if>
    <if test="orderBy != null and orderBy!=''">
      order by ${orderBy}
    </if>
  </select>

</mapper>