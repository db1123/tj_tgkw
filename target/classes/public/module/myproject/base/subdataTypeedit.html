<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--_global 公共配置文件 -->
<script language="javascript">var golbal_type="admin";</script>
<script type="text/javascript" src="/javascript/global.js"></script><!--/_global 公共配置文件-->
<!--_only 独立样式 -->
<link rel="stylesheet" href="/plugins/select2/css/select2.min.css">
<link rel="stylesheet" href="/plugins/select2-ztree/bootstrapStyle.css" />
<link rel="stylesheet" href="/plugins/jquery-jsonview/jquery.jsonview.css" />
<link rel="stylesheet" href="/nui-ad/lib/zTree/v3/css/zTreeStyle/zTreeStyle.css" />
<!--/_only 独立样式 -->
</head>
<body>
<article class="page-container">
  <form action="" method="post" class="form form-horizontal" id="subdataTypeForm">
		<div class="row cl">
			<label class="form-label col-xs-3 col-sm-2"><span class="c-red">*</span>类型名称：</label>
			<div class="formControls col-xs-8 col-sm-9">
				<input type="text" class="input-text" name="Fname" id="Fname"/>
			</div>
		</div> 
    <div class="toolbar-bottom-line"></div>
		<div class="toolbar-bottom-btn">
			<input class="btn btn-primary radius mr-20" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;" />
			<input class="btn btn-default radius ml-20" type="button" value="&nbsp;&nbsp;取消&nbsp;&nbsp;" onclick="layer_close()" />
		</div>
    <input type="hidden" value="" name="FKeyID" id="FKeyID"/>
	</form>
</article>
<script type="text/javascript" src="/nui-ad/lib/zTree/v3/js/jquery.ztree.all-3.5.min.js"></script>
<script type="text/javascript" src="/nui-ad/lib/zTree/v3/js/jquery.ztree.exhide-3.5.min.js"></script>
<script type="text/javascript" src="/plugins/select2/js/select2.full.min.js"></script>
<script type="text/javascript" src="/plugins/select2-ztree/select2-ztree.js"></script>
<script type="text/javascript" src="/plugins/select2-ztree/select2-ztree-search.js"></script>
<script src="/plugins/select2/js/select2.full.min.js"></script>
<script type="text/javascript" src="/nui-ad/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="/nui-ad/lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="/nui-ad/lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript">
// 编辑框状态 1新建 2修改
var op = getQueryStringByName('op');
// 业务代码
$(function(){
 
  // 修改操作时读取表单信息
  if (op == 2) {
      var id = getQueryStringByName('id');
	  $.ajax({
		  type: 'POST',
		  contentType: 'application/json',
		  url: '/s/subdataType/querysubdataTypeInfo', // 调用地址
		  data: JSON.stringify({
			  id: id
		  }),
		  async: false,
		  success: function(data) {
			  $('#Fname').val(data.info.FName);
			  $('#FKeyID').val(data.info.key);
		  },
		  error : function(e) {
			  toastr.error(e.status);
			  toastr.error(e.responseText);
		  }
	  });
  }
  // 检验数据
  var userValidate = $('#subdataTypeForm').validate({
	  rules: {
		  Fname: {
			  required: true,
			  levelLimit: false
		  },
	  },
	  messages: {
		  FFacname: {
			  required: '*请输入交付物类型名称'
		  },

	  },
    onfocusout: false, // 是否在获取焦点时验证
    onkeyup: false, // 是否在敲击键盘时验证
    focusInvalid: false, //提交表单后，（第一个）未通过验证的表单获得焦点
    focusCleanup: true, // 当未通过验证的元素获得焦点时，移除错误提示
    success: 'valid',
    submitHandler:function(){
		// 获取参数
		var data = form2Json('subdataTypeForm');
		if (op == 1) { // 添加操作
			$.ajax({
				type: 'POST',
				contentType: 'application/json',
				url: '/s/subdataType/addsubdataType', // 调用地址
				data: JSON.stringify(data),
				async: false,
				success: function(data) {
					if (data.result == 'success') {
						parent.$('#mainTable').DataTable().ajax.reload(null, false);
						parent.toastr.success('添加成功！');
						layer_close();
					} else if (data.result == 'fail') {
						toastr.warning('交付物类型名称重复，请重新输入');
					} else if (data.result == 'error') {
						toastr.error(data.error);
					}
				},
				error : function(e){
					toastr.error(e.status);
					toastr.error(e.responseText);
				}
			});
		}else {
			$.ajax({
				type: 'POST',
				contentType: 'application/json',
				url: '/s/subdataType/updatesubdataType', // 调用地址
				data: JSON.stringify(data),
				async: false,
				success: function(data) {
					if (data.result == 'success') {
						parent.$('#mainTable').DataTable().ajax.reload(null, false);
						parent.toastr.success('修改成功！');
						layer_close();
					} else if (data.result == 'fail') {
						toastr.warning('交付物类型名称重复，请重新输入');
					} else if (data.result == 'error') {
						toastr.error(data.error);
					}
				},
				error : function(e){
					toastr.error(e.status);
					toastr.error(e.responseText);
				}
			});
		}
    }
  });
});
</script>
</body>
</html>