<!--_meta 作为公共模版分离出去-->
<!DOCTYPE HTML>
<html>
<head>
    <meta charset="utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <!--_global 公共配置文件 -->
    <script language="javascript">var golbal_type = "admin";</script>
    <script type="text/javascript" src="/javascript/global.js"></script><!--/_global 公共配置文件-->
    <!--_only 独立样式 -->
    <link rel="stylesheet" href="/plugins/select2/css/select2.min.css">
    <link rel="stylesheet" href="/plugins/select2-ztree/bootstrapStyle.css"/>
    <link rel="stylesheet" href="/plugins/jquery-jsonview/jquery.jsonview.css"/>
    <link rel="stylesheet" href="/nui-ad/lib/zTree/v3/css/zTreeStyle/zTreeStyle.css"/>
    <!--/_only 独立样式 -->
    <link rel="stylesheet" href="/module/capability/interface/css/jsoneditor.min.css"/>
    <script src="/module/capability/interface/css/jsoneditor.min.js"></script>
    <style>
        #FInputParameters, #FReturnParameters {
            border: solid 1px #ddd;
            resize: both;
            overflow: auto;
            min-width: 200px;
            min-height: 100px;
        }
    </style>

</head>
<body>
<article class="page-container">
    <form action="" method="post" class="form form-horizontal" id="interfaceForm">
        <div class="row cl">
            <label class="form-label col-xs-3 col-sm-2"><span class="c-red">*</span>接口类型：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <select name="Finterfacetype" id="Finterfacetype" style="width: 100%;" placeholder="数据接口类型"
                        disabled="disabled"></select>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-3 col-sm-2"><span class="c-red">*</span>接口名称：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="text" class="input-text" name="FName" id="FName" disabled="disabled"/>
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-3 col-sm-2"><span class="c-red">*</span>接口调用成熟度：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <input type="number" class="input-text" name="FMaturity" id="FMaturity" placeholder="格式：0.01-1的数字"
                       style="width: 180px;" disabled="disabled"/>
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-3 col-sm-2"><span class="c-red">*</span>输入参数：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div id="jsonEditorContainer" style="width:65vw; height: 25vh;"></div>
                <input type="hidden" id="FInputParameters" name="FInputParameters">
            </div>
        </div>
        <div class="row cl">
            <label class="form-label col-xs-3 col-sm-2"><span class="c-red">*</span>返回参数：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <div id="jsonEditorContainer2" style="width:65vw; height: 25vh;" disabled="disabled"></div>
                <input type="hidden" id="FReturnParameters" name="FReturnParameters">
            </div>
        </div>

        <div class="row cl">
            <label class="form-label col-xs-3 col-sm-2"><span class="c-red">*</span>数据匹配要求：</label>
            <div class="formControls col-xs-8 col-sm-9">
                <textarea placeholder='例：请列出该项目中的存在的主要功能、结构以及数据存储方式' id="FRequire"
                          name="FRequire" rows="8" cols="30" class="input-text"
                          style="width: 100%;height:120px; box-sizing: border-box; border: solid 1px #ddd;"
                          disabled="disabled"></textarea>
            </div>
        </div>

        <!--  <div class="toolbar-bottom-line"></div> -->
        <div class="toolbar-bottom-btn" style=" bottom: auto;">
            <input class="btn btn-default radius ml-20" type="button" value="&nbsp;&nbsp;关闭&nbsp;&nbsp;"
                   onclick="layer_close()"/>
        </div>
        <input type="hidden" value="" name="FKeyID" id="FKeyID"/>
    </form>
</article>
<script type="text/javascript" src="/nui-ad/lib/zTree/v3/js/jquery.ztree.all-3.5.min.js"></script>
<script type="text/javascript" src="/nui-ad/lib/zTree/v3/js/jquery.ztree.exhide-3.5.min.js"></script>
<script type="text/javascript" src="/plugins/select2/js/select2.full.min.js"></script>
<script type="text/javascript" src="/plugins/select2-ztree/select2-ztree.js"></script>
<script type="text/javascript" src="/plugins/select2-ztree/select2-ztree-search.js"></script>
<script src="/plugins/select2/js/select2.full.min.js"></script>
<script type="text/javascript" src="/nui-ad/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="/nui-ad/lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="/nui-ad/lib/jquery.validation/1.14.0/messages_zh.js"></script>

<script type="text/javascript">
    // 编辑框状态 1新建 2修改
    var FJKID = getQueryStringByName('FJKID');
    // JSON编辑器实例
    var jsonEditor;
    var jsonEditor2;
    // 业务代码
    $(function () {

        var container = document.getElementById('jsonEditorContainer');
        jsonEditor = new JSONEditor(container, {
            mode: 'code',
            theme: 'ajv',
            onChange: function () {
                // 可以添加实时验证逻辑
            }
        });


        var container2 = document.getElementById('jsonEditorContainer2');
        jsonEditor2 = new JSONEditor(container2, {
            mode: 'code',
            theme: 'schema',
            onChange: function () {
                // 可以添加实时验证逻辑
            }
        });

        //获取接口类型列表
        $.ajax({
            type: 'POST',
            contentType: 'application/json',
            url: '/s/interfacetype/queryInterfaceTypeALL', // 调用地址
            async: false,
            success: function (data) {
                var newObj2 = Object.assign([], data.zNodes);
                newObj2.push({id: 1, pId: 0, name: '全部', open: true});
                $('#Finterfacetype').select2ztree({
                    textField: 'name',
                    titleField: 'name',
                    placeholder: '请选择接口类型',
                    ztree: {
                        setting: {
                            view: {
                                dblClickExpand: false
                            },
                            data: {
                                simpleData: {
                                    enable: true,
                                    idKey: "id",
                                    pIdKey: "pId",
                                    rootPId: 0
                                }
                            }
                        },
                        zNodes: newObj2
                    },
                    language: "zh-CN"
                });
            },
            error: function (e) {
                toastr.error(e.status);
                toastr.error(e.responseText);
            }
        });

        $.ajax({
            type: 'POST',
            contentType: 'application/json',
            url: '/s/interface/queryinterfaceInfo', // 调用地址
            data: JSON.stringify({
                id: FJKID
            }),
            async: false,
            success: function (data) {
                $('#FName').val(data.info.FName);
                $('#FInputParameters').val(data.info.FInputParameters);
                // 设置初始值
                try {
                    jsonEditor.set(JSON.parse(data.info.FInputParameters));
                } catch (e) {
                    // 如果解析失败，设置为空对象
                    jsonEditor.set({});
                    layer.msg('当前数据格式不正确，已重置为默认值', {icon: 5});
                }

                $('#FReturnParameters').val(data.info.FReturnParameters);
                // 设置初始值
                try {
                    jsonEditor2.set(JSON.parse(data.info.FReturnParameters));
                } catch (e) {
                    // 如果解析失败，设置为空对象
                    jsonEditor2.set({});
                    layer.msg('当前数据格式不正确，已重置为默认值', {icon: 5});
                }

                $('#FRequire').val(data.info.FRequire);
                $('#FMaturity').val(data.info.FMaturity);
                $("#Finterfacetype").select2ztree('val', [data.info.FtInterfaceTypeID]);
                $('#FKeyID').val(data.info.key);
            },
            error: function (e) {
                toastr.error(e.status);
                toastr.error(e.responseText);
            }
        });


    });
</script>
</body>
</html>