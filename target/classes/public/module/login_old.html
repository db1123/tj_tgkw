<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!--_global 公共配置文件 -->
<script language="javascript">var golbal_type="login";</script>
<script type="text/javascript" src="/javascript/global.js"></script><!--/_global 公共配置文件-->
<!--_only 独立样式 -->
<link rel="stylesheet" type="text/css" href="/plugins/verify/css/verify.css" />
<style type="text/css">
  label.error { top: 10px; }
</style><!--/_only 独立样式 -->
</head>
<body>
<div id="header" class="header" style="color: #FCFCFC;font-size:40px;font-weight: bold;letter-spacing: 2px;text-indent: 1em;"></div>
<div class="loginWraper">
  <div class="loginBox">
    <!-- <iframe src="http://127.0.0.1:8080/module/outside/AdaptiveDesign.html" width="1200" height="600"></iframe> -->
    <form id="LoginForm" class="form form-horizontal" method="post">
      <div class="row cl">
        <label class="form-label col-xs-3 col-sm-3" style="margin-top: 7px;"><i class="Hui-iconfont">&#xe62c;</i></label>
        <div class="formControls col-xs-7 col-sm-7">
          <input name="FLogin" type="text" placeholder="账户" class="input-text size-L">
        </div>
      </div>
      <div class="row cl">
        <label class="form-label col-xs-3 col-sm-3" style="margin-top: 7px;"><span class="fas fa-lock" style="font-size: 24px; margin-right: 1px;"></span></label>
        <div class="formControls col-xs-7 col-sm-7">
          <input name="FPass" type="password" placeholder="密码" class="input-text size-L">
        </div>
      </div>
      <div class="row cl">
        <div class="formControls col-xs-8 col-xs-offset-3">
          <div id="checkCode"></div>
        </div>
      </div>
      <div class="row cl">
        <div class="formControls col-xs-8 col-xs-offset-3">
          <label for="online" style="font-weight: 600;">
            <input type="checkbox" name="online" id="online" value="">
            使我保持登录状态
          </label>
        </div>
      </div>
      <div class="row cl">
        <div class="formControls col-xs-8 col-xs-offset-3">
          <button type="submit" class="btn btn-success radius size-XL"><b>&nbsp;登&nbsp;&nbsp;&nbsp;&nbsp;录&nbsp;</b></button>
          <button type="reset" class="btn btn-default radius size-XL"><b>&nbsp;重&nbsp;&nbsp;&nbsp;&nbsp;置&nbsp;</b></button>
        </div>
      </div>
    </form>
  </div>
</div>
<!--<div class="footer">Copyright © 2020-2022 天津大学</div>-->
  <div class="footer" id="footer"></div>
<script type="text/javascript" src="/plugins/verify/js/verify.min.js" ></script>
<script type="text/javascript" src="/nui-ad/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="/nui-ad/lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="/nui-ad/lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script type="text/javascript">
// 初始化参数
document.title = WEB_TITLE;
document.getElementById("footer").innerHTML =  FOOTER_TEXT;
document.getElementById("header").innerHTML = WEB_TITLE;

// 初始化变量
var code = getRandomNum(1000000000, 9999999999);
var oCode = null;
// 业务代码
$(function(){
  // 登录表单-检验数据
  $('#LoginForm').validate({
    rules: {
      FPass: {
        required: true,
        minlength: 6
      },
      FLogin: {
        required: true
      }
    },
    onfocusout: false, // 是否在获取焦点时验证
    onkeyup: false, // 是否在敲击键盘时验证
    focusInvalid: false, // 提交表单后，（第一个）未通过验证的表单获得焦点
    focusCleanup: true, // 当未通过验证的元素获得焦点时，移除错误提示
    success: 'valid',
    submitHandler: function(){
      if (oCode == null) {
        toastr.warning('请先完成验证');
      } else {
        $("body").mLoading("show");
        var formData = form2Json('LoginForm');
        formData['code'] = code;
        formData['oCode'] = oCode;
        $.ajax({
          type: 'POST',
          contentType: 'application/json',
          url: '/s/entry/login', // 调用地址
          data: JSON.stringify(formData),
          success: function(data) {
            if (data.result == "success") {
              localStorage.setItem('simulation_dmsnid', data.simulation_dmsnid);
              window.location.href= '/module/main.html';
            } else {
              toastr.error(data.result);
              $("body").mLoading("hide");
            }
          },
          error: function(e) {
            toastr.error(e.status);
            toastr.error(e.responseText);
            $("body").mLoading("hide");
          }
        });
      }
    }
  });
  // 验证码
  $('#checkCode').slideVerify({
    type: 1, // 类型
    vOffset: 5, // 误差量，根据需求自行调整
    barSize: {
      width: '89%',
      height: '40px',
    },
    ready: function() {},
    success: function() {
      $.ajax({
        type: 'POST',
        contentType: 'application/json',
        url: '/s/entry/oCode', // 调用地址
        async: false,
        data: JSON.stringify({
          code
        }),
        success: function(data) {
          if (data.result == "success") {
            oCode = data.oCode;
          } else {
            toastr.error(data.result);
          }
        },
        error: function(e) {
          toastr.error(e.status);
          toastr.error(e.responseText);
        }
      });
    },
    error: function() {
      alert('验证失败！');
    }
  });
});
</script>
</body>
</html>